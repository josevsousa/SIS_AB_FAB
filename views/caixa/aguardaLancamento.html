{{extend 'layoutLojinha.html'}}
<link rel="stylesheet" href="{{=URL('static','jquery-ui-1.11.4.custom/jquery-ui.css')}}">
<script src="{{=URL('static','jquery-ui-1.11.4.custom/jquery-ui.js')}}"></script>
<style>
    blockquote.control-label {
        /* display: flex; */
        /* background: aqua; */
        /* width: 361px; */
        position: fixed;
        left: 219px;
        top: 67px;
    }

    #trModal>img {
        margin-left: 50%;
        display: none;
    /* font-size: 2px; */
    }
    .grid_data {
        width: 17%;
    }
    .grid_dono {
        width: 45%;
    }
    .grid_cheque {
        width: 15%;
    }
    .grid_parcela {
        width: 45px;
    }
    input.form-control.inputGrid {
        height: 26px;
        font-size: 13px;
        width: 100%;
    }
    div#campoNomeRepasse {
        margin-top: 7px;
    }
    span#lenLancamentos{
        background: #FF9D01;
    }
    .debito{
        color: red;
        font-weight: 600;
    }
    .verde{
        color:#0AAB2F;
        font-weight: 600;
    }
    .laranja{
        color:#FF9D00;
        font-weight: 600;        
    }
	.containerRadio {
	    padding-left: 23px;
	}
	.containerRadio label{
	    margin: 0 !important;
	}
	.oculto{display:none;}
	#minhaTabela {
		-webkit-touch-callout: none;
		-webkit-user-select: none;
		-khtml-user-select: none;
		-moz-user-select: none;
		-ms-user-select: none;
		user-select: none;
	}
	.atualizar{float: right;}
	.JpositionA{float: right;}
	.JpositionA a{margin-right: 0px !important;}
	.ativoo{
		background: #E3FFF6;
	}
	#minhaTabela input {
    	height: 22px;
	}
.modal-dialog {
    width: 70%;
}
select#qtde_parcelas {
    width: 63px;
}
</style>
<script>
    function carregar_masck(){
        $(".real").maskMoney({prefix:'R$ ', allowNegative: true, thousands:'.', decimal:','});
        $(".grid_data input").datepicker();
    }
        
    $(document).ready(function(){
        $('#minhaTabela').DataTable({
            // "scrollX": true,
            "order": [ 0, 'desc' ],
            "language": {
              "url": "{{=URL('static','js/tradutorTable.json')}}"
            }
            
        });
        function inputNome(){ 
            $('#cliente').keyup(function(){
                var v = $(this).val();
                $(this).val(v.toUpperCase());
            });
        }; 

        function inputQtde(cod, valor, cliente){
            /*
                var time = new Date('2014-03-14T23:54:00');
                var outraData = new Date();
                outraData.setDate(time.getDate() + 3); 
            */
            var valor = valor;
            valor = valor.replace("R$ ","");
            valor = valor.replace(".","");
            valor = valor.replace(",",".")
            valor = parseFloat(valor);
            
            $('#qtde_parcelas').on('change',function(){
                var qtdeP = $(this).val(); //qtde de parcelas pego do select
                $('#transitory').val(qtdeP+";"+valor+";"+cliente);
                $('#trModal>img').show(400);
                ajax('gridParcelas',['transitory'],'trModal');

            })    
        }

        //=== BUSCAR REGISTRO
        $('#minhaTabela').on('dblclick','tr', function(){
			var iten = $(this)[0]
			var codigo = iten.children[1].textContent;
            var cliente = iten.children[3].textContent;
			var valor = iten.children[4].textContent;
			
            //================== MODAL ======          
                
               var titulo = '<small>CÓDIGO:</small> '+codigo+ ' <small> TOTAL:</small> '+valor;
                
                //chama o modal            
    			$('#myModal').modal('show');
    			
                //quando o modal abrir faça
                $('#myModal').on('shown.bs.modal', function () {

                    inputQtde(codigo, valor, cliente);
                    // $("#status").prop('selectedIndex',status);
                    $("#myModalLabel").html(titulo);
                     carregar_masck();
                })

                //botao gravar do modal
                $('#gravar').on('click',function(){
                    //pegar os campos do modal e passar para o ajax gravar no db

                    // var cheque_Modal = $('#cheque').val();
                    // var cliente_Modal = $('#cliente').val();
                    // var data_Modal = $('#data').val();
                    // var status_Modal = $('#status').val();
                    // var receptor = $('#receptor').val();
                    // $(this).text('gravando...');
                    // $('#transitory').val(id+';'+cheque_Modal+';'+cliente_Modal+';'+status_Modal+';'+data_Modal+';'+receptor);
                    // console.log(data_Modal);
                    // ajax('atualizarParcelados',['transitory']);
                    $("#myModal").modal('hide');
                })
                
                //quando o modal fechar
                $('#myModal').on('hide.bs.modal', function () {
                    location.reload();//reload na pagina pra carregar as alteracoes na tabela
                })

            //==== FIM MODAL ======

		}); //fim do busca registro
        
});//fim jquary ready
</script>

<input type="text" id="transitory" name="transitory" style='display:none'>

<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Modal title</h4>
      </div>
      <div class="modal-body">
            <form id="model_form">
                    <!--  <div class="form-group">
                        <label for="recipient-name" class="control-label">Data parcela Nº <span id="parc"></span></label>
                        <input type="date" class="form-control" id="data" >
                    </div>
                     -->
                     <div class="form-group form-inline">
                        <div class="boxSelect">
                        <label for="recipient-name" class="control-label">Qtde de parcelas : </label>
                        <select class="form-control" id="qtde_parcelas">
                          <option value="0">0</option>
                          <option value="1">1</option>
                          <option value="2">2</option>
                          <option value="3">3</option>   
                          <option value="4">4</option>           
                        </select>   
                        </div>
                        <blockquote class="control-label">
                          <p>Entre com a quantidade de parcelas.</p>
                        </blockquote>
                    </div> 
                     

                    <div id="trModal"class="form-group form-inline" >
                        <img src="{{=URL('static','images/loading-2.gif')}}" alt="">
                    </div>
   
                    <!-- fim repassado -->
                </form>  
 
  
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Fechar</button>
        <button type="button" id="gravar" class="btn btn-success">Atualizar</button>
      </div>
    </div>
  </div>
</div><!-- fim do Modal -->
<div class="container animated fadeIn">
	<div class="row"> 
        <form id="opcaoCheque">
            <div class="col-md-4"> 
                <ul class="list-group">
                  <li class="list-group-item">
                    <span class="badge" id="lenLancamentos">{{=qt}}</span>
                    <div class="containerRadio">
                        <label class="radio laranja">
                            <input type="radio" checked  name="inlineRadioOptions" id="inlineRadio1" value="option1"> Aguardando lançamento
                        </label>
                    </div>  
                  </li>
                  <li class="list-group-item">
                    <div class="containerRadio">
                        <label class="radio">
                            <input type="radio" name="inlineRadioOptions" id="inlineRadio2" value="option2"> Compensado
                        </label>
                    </div>
                  </li>
                </ul>
            </div>  
            <div class="col-md-4"> 
                <ul class="list-group">
                  <li class="list-group-item">
                    <div class="containerRadio">
                        <label class="radio">
                            <input type="radio" name="inlineRadioOptions" id="inlineRadio5" value="option3"> Devolvido ao cliente
                        </label>
                    </div>  
                  </li>
                  <li class="list-group-item">
                    <div class="containerRadio">
                        <label class="radio">
                            <input type="radio" name="inlineRadioOptions" id="inlineRadio6" value="option4"> Repassado
                        </label>
                    </div>
                  </li>
                </ul>
            </div>
            <div class="col-md-4"> 
                <ul class="list-group">
                  <li class="list-group-item">
                    <div class="containerRadio">
                        <label class="radio">
                            <input type="radio" name="inlineRadioOptions" id="inlineRadio3" value="option5"> Devolvido 1-Vez
                        </label>
                    </div>  
                  </li>
                  <li class="list-group-item">
                    <div class="containerRadio">
                        <label class="radio">
                            <input type="radio" name="inlineRadioOptions" id="inlineRadio4" value="option6"> Devolvido 2-Vez
                        </label>
                    </div>
                  </li>
                </ul>
            </div>     
        </form>
    </div> 
    <h4>Tela de lançamento de cheques <small>Clique duas (2) vezes para atualizar o fechamento! </small></h4>   
    <hr>
    <div class="row">
        <div class="col-md-12">
            <!-- table -->
            <table id="minhaTabela" class="table hover table-striped" cellspacing="0" width="100%" >
            <thead>
                <tr>
                    <th class="oculto">id</th>
                    <th>Código venda</th>
                    <th>Representante</th>
                    <th>Cliente</th>
                    <th>Valor da venda</th>
                </tr> 
                <tbody>
                    {{for i in table:}}
                        <tr>
                            <td class="oculto">{{=i.id}}</td>
                            <td>{{=i.codigoVenda}}</td>
                            <td>{{=db(db.representantes.id==i.representante).select('nome')[0].nome}}</td>
                            <td>{{=db(db.clientes.id==i.clienteEmail).select('nome')[0].nome}}</td>
                            <td>{{=double_real(i.valorVenda).real()}}</td>  
                        </tr>
                    {{pass}}
                </tbody>
            </thead>
            </table>
        </div>    
    </div>
</div>